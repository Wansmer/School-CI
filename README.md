# School-CI: непрерывная интеграция - ни один коммит не уйдет не собранным. 

> Версия node: v12.16.2

> Api https://hw.shri.yandex/api/index.html по задумке организаторов периодически (очень часто) возвращает ошибку 500, из-за чего настройки в приложении могут сохраняться не с первого раза. При возврате ошибки нужно обновить страницу и повторить запрос.

> Установку `./server` и `./agent` можно пропустить, если нет задачи проводить реальную сборку.

## Домашнее задание: Локализация

##### Проект на gitLocalize [здесь](https://gitlocalize.com/repo/4636).

##### Комметарии к заданию:

1. как приложение узнает, какой язык выбран у пользователя?

Для реализации перевода выбрана библиотека i18next (react-i18next) - в ней есть опция определения языка браузера. При смене языка выбранное значение сохраняется в localStorage, что позволяет сохранять выбранный язык при перезагрузке страниц. 

> значения в localStorage от библиотеки i18next сбрасывались при перезагрузке страницы, поэтому добавил хранение вручную.

2. какие типы контента поддерживают переключение языка и как вы это реализовали

Все текстовые типы контента, которые являются статическими: все надписи, кнопки, описания, ссылки и т.д.  
Настройки пользователя, название сервиса и ошибки не переводятся.  
Реализовано с помощью i18next - под каждый язык свой json. 

Интернационализация отображения даты была изначально сделана через toLocaleString, просто убрал захардкоденную локаль - теперь передаю параметром. 

3. как переводы попадают на клиент? как изменилась сборка приложения?

Переводы подгружаются с помощью i18next-fetch-backend. Сборка не изменилась.

## Начало работы:
1. Клонировать репозиторий с проектом;
2. В командной строке перейти в директорию проекта и переключится на ветку задания, которая была написана в тикете:
```bash
% git checkout NAME_OF_BRANCH
```

## Предварительная настройка: 
1. Перейти в поддиректорию `./server`;
2. Создать файл `.env` в корне поддиректории;
3. Добавить в файл следующий текст:

```json
SECRET_KEY = 'Bearer YOUR_SECRET_KEY'
NODE_TLS_REJECT_UNAUTHORIZED = '0'
```

4. Убедиться, что файл сохранен, а значение SECRET_KEY начинается с Bearer<пробел>;
5. Перейти к запуску проекта.

## Запуск проекта (react + serverFront): 

1. В командной строке перейти в директорию проекта и запустить команды последовательно: 
  - Предварительная установка пакетов:
```bash
% npm i
```
  - Установка пакетов в поддиректориях `./client` и `./serverFront`:
```bash
% npm run postinstall
```
  - Запуск серверов (client - порт 3000, server - порт 3001):
```bash
% npm run start
```
2. ...

3. PROFIT! Проект запущен и автоматически открылся в вашем браузере по адресу [http://localhost:3000](http://localhost:3000).

### Приложение BuildServer `./server`;
1. Перейти в директорию, создать файл `./server-conf.js` и поместить в него следующий текст и добавить свой токен (без Bearer) и изменить `port`, если это необходимо:

```js
{
  "port": 8080,
  "apiBaseUrl": "https://hw.shri.yandex/api/",
  "apiToken": "SET_YOUR_TOKEN_HERE"
}
```

2. Установить зависимости: 
```bash
% npm ci
```

3. Запустить сервер:
```bash
% npm start
```

### Приложение(я) Agent `./agent`.
1. Установить зависимости: 
```bash
% npm ci
```

2. В случае необходимости, изменить поля в файле настроек `./agent-conf.js` на актуальные: 

```js
{
  "port": 8081,
  "serverHost": "localhost",
  "serverPort": 8080
}
```

3. Запустить сервер:
```bash
% npm start
```

4. Для создания дополнительных агентов нужно сделать копии деректории `./agent` и присвоить им уникальные имена (пример):
```asp
./agent
./agent_smit
./agent_007
./agent_SHIELD
./agent_ancl
```

5. В каждом `./agent-conf.js` в поле `port` присвоить свой  уникальный незанятый порт: 
```js
// agent_smit
{
  "port": 8081,
  "serverHost": "localhost",
  "serverPort": 8080
}
// agent_007
{
  "port": 8082,
  "serverHost": "localhost",
  "serverPort": 8080
}
```

6. Повторить шаги с 1 до 3 для каждого агента. 
